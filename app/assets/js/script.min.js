var adriftApp=angular.module("adriftApp",["ngRoute","customFilters","userControllers","topicControllers"]);adriftApp.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode({enabled:true});$routeProvider.when("/adrift/locations",{templateUrl:"partials/topics/index.html",controller:"TopicIndexCtrl"}).when("/adrift/settings",{templateUrl:"partials/users/settings.html",controller:"UserSettingsCtrl"}).when("/adrift/collection",{templateUrl:"partials/users/collection.html",controller:"UserCollectionCtrl"}).when("/adrift/locations/:topicId",{templateUrl:"partials/topics/show.html",controller:"TopicShowCtrl"}).otherwise({redirectTo:"/adrift/locations"})}]);adriftApp.controller("MessageRequestCtrl",["$scope","$http","$interval",function($scope,$http,$interval){angular.element(document).ready(function(){$scope.requestMessage=function(){$http.get("/messages").success(function(data){console.log("Getting Messages...")})};$interval($scope.requestMessage,1e3)})}]);angular.module("customFilters",[]).filter("capitalize",function(){return function(input,scope){if(input!=null)input=input.toLowerCase();return input.substring(0,1).toUpperCase()+input.substring(1)}});// Topic Controllers
var topicControllers=angular.module("topicControllers",[]);topicControllers.controller("TopicIndexCtrl",["$scope","$http",function($scope,$http){$http.get("topics/").success(function(data){$scope.topics=data.topics})}]);topicControllers.controller("TopicShowCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){$http.get("topics/"+$routeParams.topicId).success(function(data){$scope.topic=data.topic})}]);topicControllers.controller("TopicSubscribeCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){$http.get("users/current").success(function(data){$scope.currentUser=data.currentUser;if($scope.currentUser.topics.indexOf($routeParams.topicId)!=-1){$scope.subscription="Subscribed";$scope.subscribed=true}else{$scope.subscription="Subscribe";$scope.subscribed=false}$scope.locationSubscribe=function(){if($scope.subscribed==false){$http.patch("users/topics/"+$routeParams.topicId).success(function(data,status){console.log(data)});$scope.subscription="Subscribed";$scope.subscribed=true}else if($scope.subscribed==true){$http.delete("users/topics/"+$routeParams.topicId).success(function(data,status){console.log(data)});$scope.subscription="Subscribe";$scope.subscribed=false}}})}]);topicControllers.controller("TopicMessageCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){$scope.message={_topic:$routeParams.topicId};$scope.addMessage=function(message){$scope.messageCopy=angular.copy($scope.message);$http.post("messages/",{message:$scope.messageCopy}).success(function(data,status){$scope.status=status;$scope.data=data;$scope.result=data});$scope.message.content=""}}]);// User Controllers
var userControllers=angular.module("userControllers",[]);userControllers.controller("UserIndexCtrl",["$scope","$http",function($scope,$http){$http.get("users/").success(function(data){console.log(data)})}]);userControllers.controller("UserCollectionCtrl",["$scope","$http","$interval",function($scope,$http,$interval){$scope.checkForMessage=function(){$http.get("users/current").success(function(data){if(data.currentUser.pendingMessage){$scope.pendingMessage=data.currentUser.pendingMessage;$scope.decision="Accept";console.log("Checking for Message...")}})};$interval($scope.checkForMessage,1e3);$http.get("users/current").success(function(data){if(data.currentUser.messages[0]){$scope.messages=data.currentUser.messages}if(data.currentUser.pendingMessage){$scope.pendingMessage=data.currentUser.pendingMessage;$scope.decision="Accept"}});$scope.acceptMessage=function(){$scope.keep=true;$scope.keepMessage($scope.keep)};$scope.releaseMessage=function(){$scope.keep=false;$scope.keepMessage($scope.keep)};$scope.keepMessage=function(decision){$http.post("/messages/decision",{keep:decision}).success(function(data){if(data.status!="failure"){if($scope.keep==true){$scope.messages.push($scope.pendingMessage)}$scope.pendingMessage=null}})}}]);userControllers.controller("UserSettingsCtrl",["$scope","$http","$routeParams",function($scope,$http){$http.get("users/current").success(function(data){$scope.user=data.currentUser})}]);