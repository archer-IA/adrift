var adriftApp=angular.module("adriftApp",["ngRoute","customFilters","userControllers","topicControllers"]);adriftApp.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode({enabled:true});$routeProvider.when("/adrift/locations",{templateUrl:"partials/topics/index.html",controller:"TopicIndexCtrl"}).when("/adrift/settings",{templateUrl:"partials/users/settings.html",controller:"UserSettingsCtrl"}).when("/adrift/collection",{templateUrl:"partials/users/collection.html",controller:"UserCollectionCtrl"}).when("/adrift/locations/:topicId",{templateUrl:"partials/topics/show.html",controller:"TopicShowCtrl"}).otherwise({redirectTo:"/adrift/locations"})}]);// User Controllers
var userControllers=angular.module("userControllers",[]);userControllers.controller("UserIndexCtrl",["$scope","$http",function($scope,$http){$http.get("users/").success(function(data){console.log(data)})}]);userControllers.controller("UserCollectionCtrl",["$scope","$http","$routeParams",function($scope,$http){$http.get("users/current").success(function(data){if(data.currentUser.pendingMessage[0]){$scope.pendingMessageContent=data.currentUser.pendingMessage[0].content[0];if($scope.pendingMessageContent){$scope.request="Requested";$scope.requested=true}else{$scope.request="Request";$scope.requested=false}}});$scope.requestMessage=function(){if($scope.requested==false){$http.get("messages/").success(function(data,status){$scope.pendingMessageContent=data.message.content[0]});$scope.request="Requested";$scope.requested=true}else if($scope.requested==true){console.log("already requested")}}}]);userControllers.controller("UserSettingsCtrl",["$scope","$http","$routeParams",function($scope,$http){$http.get("users/current").success(function(data){console.log(data)})}]);
// Topics Controllers
var topicControllers=angular.module("topicControllers",[]);topicControllers.controller("TopicIndexCtrl",["$scope","$http",function($scope,$http){$http.get("topics/").success(function(data){$scope.topics=data.topics})}]);topicControllers.controller("TopicShowCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){$http.get("topics/"+$routeParams.topicId).success(function(data){$scope.topic=data.topic})}]);topicControllers.controller("TopicSubscribeCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){$http.get("users/current").success(function(data){$scope.currentUser=data.currentUser;if($scope.currentUser.topics.indexOf($routeParams.topicId)!=-1){$scope.subscription="Subscribed";$scope.subscribed=true}else{$scope.subscription="Subscribe";$scope.subscribed=false}$scope.locationSubscribe=function(){if($scope.subscribed==false){$http.patch("users/topics/"+$routeParams.topicId).success(function(data,status){console.log(data)});$scope.subscription="Subscribed";$scope.subscribed=true}else if($scope.subscribed==true){$http.delete("users/topics/"+$routeParams.topicId).success(function(data,status){console.log(data)});$scope.subscription="Subscribe";$scope.subscribed=false}}})}]);topicControllers.controller("TopicMessageCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){$scope.message={_topic:$routeParams.topicId};$scope.addMessage=function(message){$scope.messageCopy=angular.copy($scope.message);$http.post("messages/",{message:$scope.messageCopy}).success(function(data,status){$scope.status=status;$scope.data=data;$scope.result=data});$scope.message.content=""}}]);angular.module("customFilters",[]).filter("capitalize",function(){return function(input,scope){if(input!=null)input=input.toLowerCase();return input.substring(0,1).toUpperCase()+input.substring(1)}});